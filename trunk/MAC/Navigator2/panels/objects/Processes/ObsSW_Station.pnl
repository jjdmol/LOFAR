V 10
1
LANG:1 0 
PANEL,-1 -1 995 220 N "_3DFace" 0
"main()
{
  baseDP=g_currentDatapoint;
  station_selectedStation = dpSubStr(baseDP,DPSUB_SYS);
  stationDBName.text(station_selectedStation);  
}" 0
 E E E E 1 -1 -1 0  0 0
""0  1
E "#uses \"navPanel.ctl\"
#uses \"Station_Processes.ctl\"

string          baseDP              = \"\";
string          database            = \"\";
bool            bDoubleClicked      = false;


// routine for single mouse click
void click(string originator) {
  // set delay in case double click was meant
  delay(0, 100); 
  if (!bDoubleClicked) {
    if (originator == \"stationTree\") {
      navPanel_setEvent(stationTree.selectedItem(),\"EventClick\");
    } else if (originator == \"activeObs\") {
      station_obsBaseDP=activeStationObs.selectedItem();
      station_selectedObservation=activeStationObs.getText(activeStationObs.selectedItem(),0);
      Station_Processes_UpdateStationTree();      
    }
  }
}

// routine for double mouse click
void dblClick(string originator) {
  // indicate this is a doubleClick
  bDoubleClicked = true; 
  
  string newDP=\"\";
  if (originator == \"stationTree\") {
    newDP=stationTree.selectedItem()+\":\"+dpSubStr(baseDP,DPSUB_DP);
  } else if (originator == \"activeObs\") {
    newDP=stationTree.selectedItem();
  }
  
  if (dpExists(baseDP) ) {
    if (originator == \"stationTree\") {
      LOG_DEBUG(\"ObsSW_Station.pnl:DoubleClick|Setting currentDatapoint from : \"+g_currentDatapoint+\" to \"+baseDP);
      g_currentDatapoint=baseDP;
      navPanel_setEvent(\"ObsSW_Station|\"+stationTree.getText(stationTree.selectedItem(),0),\"ChangePanel\"); 
    } else if (originator == \"activeObs\") {
//    LOG_DEBUG(\"ObsSW_Station.pnl.pnl:DoubleClick|Setting currentDatapoint from : \"+g_currentDatapoint+\" to \"+baseDP);
//    g_currentDatapoint=baseDP;
//    navPanel_setEvent(\"ObsSW_Station|\"+activeStationObs.getText(activeStationObs.selectedItem(),0),\"ChangePanel\");  
    }
  }
  
  // set delay to avoid click event will be triggered
  delay(0, 500);
  bDoubleClicked = false;
}

// routine for right mouse click
void rClick(string originator) {
  if (originator == \"stationTree\") {
    navPanel_setEvent(\"ObsSw_Station|\"+stationTree.getText(stationTree.selectedItem(),0),\"EventRightClick\");
  } else if (originator == \"activeObs\") {
    navPanel_setEvent(\"ObsSw_Station|\"+activeStationObs.getText(activeStationObs.selectedItem(),0),\"EventRightClick\");
  }
}

" 0
 2
"CBRef" "1"
"EClose" E
""
DISPLAY_LAYER, 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
LAYER, 0 
1
LANG:1 0 
2 1
"PRIMITIVE_TEXT3"
""
1 370 0 E E E 1 E 1 E N "_WindowText" E N "_Transparent" E E
 E E
3 0 0 0 0 0
E E E
0
1
LANG:1 0 

1
"dashclr"N "_Transparent"
E E 0 1 1 2 1 E U  1 E 370 0 430 21
0 2 2 "0s" 0 0 0 192 0 0  370 0 1
1
LANG:1 101 -*-MS Shell Dlg-bold-r-normal-*-16-*-100-100-*-*-iso8859-1|-16,0,0,0,758,0,0,0,0,0,0,0,0,MS Shell Dlg
0 ""
1
LANG:1 5 ObsSW
29 4
"stationTree"
""
1 1182 -113.812949640288 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
7 0 0 0 0 0
E E E
0
1
LANG:1 19 Active Observations

8
"frameShadow" "enum 48"
"selectionMode" "enum 0"
"backgroundOrigin" "enum 0"
"defaultRenameAction" "enum 0"
"frameShape" "enum 6"
"vScrollBarMode" "enum 0"
"hScrollBarMode" "enum 0"
"resizeMode" "enum 0"
 822 20 992 188
10 TreeWidget
7
0 "expanded" "(string id)"
""
0 "collapsed" "(string id)"
""
0 "selectionChanged" "(string id)"
""
0 "clicked" "(string id, int column)"
"   click(\"stationTree\");"
0 "doubleClicked" "(string id, int column)"
"  dblClick(\"stationTree\");"
0 "rightClicked" "(string id, int column)"
"  rClick(\"stationTree\");"
0 "itemRenamed" "(string id, int column, string text)"
""
"main()
{
  stationTree.addColumn(\"Involved Stations\");
  stationTree.setColumnWidth(0,201);
}    
    
" 0
29 5
"activeStationObs"
""
1 361 -52.9509850063874 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
9 0 0 0 0 0
E E E
0
1
LANG:1 19 Active Observations

0
 0 20 170 188
10 TreeWidget
7
0 "expanded" "(string id)"
""
0 "collapsed" "(string id)"
""
0 "selectionChanged" "(string id)"
""
0 "clicked" "(string id, int column)"
"   click(\"activeObs\");"
0 "doubleClicked" "(string id, int column)"
"  dblClick(\"activeObs\");"
0 "rightClicked" "(string id, int column)"
"  rClick(\"activeObs\");"
0 "itemRenamed" "(string id, int column, string text)"
""
"main()
{
  activeStationObs.addColumn(\"Active Observations\");
  activeStationObs.setColumnWidth(0,201);
  if (!dpExists(MainDBName+\"LOFAR_PermSW_MACScheduler.activeObservations\")) {
    setValue(\"activeStationObs\",\"backCol\",\"_dpdoesnotexist\");
  } else {
    dpConnect(\"activeStationObsCallback\",true,\"LOFAR_PermSW_MACScheduler.activeObservations\");
  }
}


activeStationObsCallback(string dp1, dyn_string activeObservations) {

  // empty the table
  activeStationObs.clear();
  station_obsBaseDP=\"\";  
  
  // if the active observations list changes the list here should be changed also.
  // iterate over the found entries and fill the table
  // if no previous Observation selected, set selection to the first on the list, also
  // set it here when previous selection disappeared from the list.
  // otherwise nothing will be changed in the selection
  
  // check if this station is involved in an active observation, if so it will be added to the list

  string newSelection=\"\";
  string oldSelection=activeStationObs.selectedItem();
  for (int i=1; i<= dynlen(activeObservations);i++) {
    string realName=claimManager_nameToRealName(\"LOFAR_ObsSW_\"+activeObservations[i]);
    int j = dynContains(g_observations[\"NAME\"],\"LOFAR_ObsSW_\"+activeObservations[i]);
    if ( j > 0) {
      // get the Stationlist from that observation
      string sts=g_observations[\"STATIONLIST\"][j];
      dyn_string stations = strsplit(sts,\",\");
      for (int k=1; k<= dynlen(stations);k++) { 
        if (stations[k]+\":\" == station_selectedStation) {
          if (station_obsBaseDP == \"\") {
            station_obsBaseDP=realName;
            station_selectedObservation=activeObservations[i];
          }
          activeStationObs.appendItem(\"\",realName,activeObservations[i]);
          activeStationObs.ensureItemVisible(realName);
          activeStationObs.setIcon(realName,0,\"16_empty.gif\");
        }
      }
    }
    if (station_obsBaseDP != \"\") {
      newSelection=station_obsBaseDP;
    }
  }
  
  if ((oldSelection == newSelection) ||
      (oldSelection != \"\" && activeStationObs.itemExists(oldSelection))) {
    activeStationObs.setSelectedItem(oldSelection,true);    
    // nothing further needed
    return;
  } else {
    activeStationObs.setSelectedItem(newSelection,true);    
  }
  // something has changed, so update Station Tree
  Station_Processes_UpdateStationTree(); 
   
}
" 0
2 46
"PRIMITIVE_TEXT4"
""
1 297 22 E E E 1 E 1 E N "_WindowText" E N "_Transparent" E E
 E E
21 0 0 0 0 0
E E E
0
1
LANG:1 0 

1
"dashclr"N "_Transparent"
E E 0 1 1 2 1 E U  1 E 297 22 318 36
0 2 2 "0s" 0 0 0 192 0 0  297 22 1
1
LANG:1 98 -*-MS Shell Dlg-*-r-normal-*-11-*-100-100-*-*-iso8859-1|-11,0,0,0,505,0,0,0,0,0,0,0,0,MS Shell Dlg
0 ""
1
LANG:1 5 error
2 47
"PRIMITIVE_TEXT5"
""
1 372 22 E E E 1 E 1 E N "_WindowText" E N "_Transparent" E E
 E E
23 0 0 0 0 0
E E E
0
1
LANG:1 0 

1
"dashclr"N "_Transparent"
E E 0 1 1 2 1 E U  1 E 372 22 435 36
0 2 2 "0s" 0 0 0 192 0 0  372 22 1
1
LANG:1 98 -*-MS Shell Dlg-*-r-normal-*-11-*-100-100-*-*-iso8859-1|-11,0,0,0,505,0,0,0,0,0,0,0,0,MS Shell Dlg
0 ""
1
LANG:1 13 currentAction
2 48
"PRIMITIVE_TEXT6"
""
1 453 22 E E E 1 E 1 E N "_WindowText" E N "_Transparent" E E
 E E
25 0 0 0 0 0
E E E
0
1
LANG:1 0 

1
"dashclr"N "_Transparent"
E E 0 1 1 2 1 E U  1 E 453 22 487 36
0 2 2 "0s" 0 0 0 192 0 0  453 22 1
1
LANG:1 98 -*-MS Shell Dlg-*-r-normal-*-11-*-100-100-*-*-iso8859-1|-11,0,0,0,505,0,0,0,0,0,0,0,0,MS Shell Dlg
0 ""
1
LANG:1 6 logMsg
2 80
"stationDBName"
""
1 180 20 E E E 1 E 1 E N "Blue" E N "_Transparent" E E
 E E
34 0 0 0 0 0
E E E
0
1
LANG:1 0 

1
"dashclr"N "_Transparent"
E E 0 1 1 2 1 E U  1 E 180 20 218 34
0 2 2 "0s" 0 0 0 192 0 0  180 20 1
1
LANG:1 101 -*-MS Shell Dlg-bold-r-normal-*-11-*-100-100-*-*-iso8859-1|-11,0,0,0,758,0,0,0,0,0,0,0,0,MS Shell Dlg
0 ""
1
LANG:1 7 station
1 81 20 "" 4
0
1 82 20 "" 3
0
1 83 20 "0" 1
0
1 84 20 "" 2
0
1 85 20 "" 6
0
1 86 21 "" 4
0
1 87 21 "" 3
0
1 88 21 "0" 1
0
1 89 21 "" 2
0
1 90 21 "" 6
0
1 91 22 "" 4
0
1 92 22 "" 3
0
1 93 22 "0" 1
0
1 94 22 "" 2
0
1 95 22 "" 6
0
0
LAYER, 1 
1
LANG:1 0 
0
LAYER, 2 
1
LANG:1 0 
0
LAYER, 3 
1
LANG:1 0 
0
LAYER, 4 
1
LANG:1 0 
0
LAYER, 5 
1
LANG:1 0 
0
LAYER, 6 
1
LANG:1 0 
0
LAYER, 7 
1
LANG:1 0 
0
3 20 "PANEL_REF21"
"objects/Processes\\station_interactive_controller_small.pnl" 170 40 T 35 1 0 1 0 -4
2
"$databaselevel""station"
"$name""BeamCtrl"
3 21 "PANEL_REF22"
"objects/Processes\\station_interactive_controller_small.pnl" 170 90 T 36 1 0 1 0 -4
2
"$databaselevel""station"
"$name""CalCtrl"
3 22 "PANEL_REF23"
"objects/Processes\\station_interactive_controller_small.pnl" 170 140 T 37 1 0 1 0 -4
2
"$databaselevel""station"
"$name""TBBCtrl"
0