<html>
<head><title>Offringa's RFI software FAQ</title></head>
<body>
<a href="http://www.astro.rug.nl/~offringa/">Offringa</a>-&gt;<a href="index.html">RFI software</a>-&gt;FAQ
<h2>Frequently asked questions</h2>
<p>Contents:</p>
<ul>
<li>Where should I start with reading documentation about the tools?</li>
<li>I like to use the GUI on LOFAR data but it is not installed</li>
<li>Does rficonsole work on WSRT / VLA / GMRT / ... data?</li>
<li>I get bad results, how to solve?</li>
<li>I suspect a presence of RFI in my final reduced data</li>
<li>How does rficonsole handle multiple bands in the same observation?</li>
<li>How does rficonsole handle multiple fields in the same observation?</li>
<li>RFI console uses too much memory!</li>
<li>RFI console does not seem to use CPU / does not progress</li>
<li>Crashes with a 'FLAG is readonly' message</li>
<li>Plotting does not work in the GUI</li>
<li>How do I use this new, faster reading mode?</li>
<li>Where is the newest version of the RFI tools?</li>
<li>Does rficonsole store e.g. the statistics in a log?</li>
<li>How does RFI console recognise RFI?</li>
<li>I still have questions / contact info</li>
</ul>
<h3>Where should I start with reading documentation about the tools?</h3>
<p>At present, there is not so much information on the RFI tools. If you are reducing LOFAR data, you should at least read the <a href="http://www.astron.nl/radio-observatory/lofar/lofar-imaging-cookbook">LOFAR imaging cookbook</a>. A first tutorial on the GUI can be found here: <a href="gui-tutorial.html">RFI gui tutorial</a>. More documentation might follow in this website, and of course scanning through this FAQ might solve some of your questions. See the "How does RFI console recognise RFI" faq item for some links to scientific papers about the flagger.</p>
<h3>I like to use the GUI on LOFAR data but it is not installed</h3>
<p>At the moment it is not, because the GUI needs GTKMM, which is not available at the cluster nodes. If you like to use the GUI, you can compile it yourself. See <a href="http://www.astro.rug.nl/rfi-software">http://www.astro.rug.nl/rfi-software</a> for information on downloading the source code, compiling and the dependencies. Alternatively, if you have access to the Groningen Kapteyn Institute network, you can mail me for instructions on how to start the GUI.</p>
<h3>Does rficonsole work on WSRT / VLA / GMRT / ... data?</h3>
<p>Yes, it does. As far as I know, it has already been tested and shown good results on LOFAR, WSRT, VLA and GMRT data. The only requirement is that the data is stored in the Aips++ / casa Measurement Set format (in my personal opinion, this is one of the best formats around for radio observations). If you have results for other telescopes, I'd love to hear about it.</p>
<p>Note though, that the settings have been optimized for LOFAR, and some of the settings might need to be changed to get good results. See the "I get bad results, how te solve?" question for more info.</p>
<h3>I get bad results, how to solve?</h3>
<p>Strong sources and different telescope properties can cause the default settings to fail in certain cases. The gui can help you a lot when trying to solve problems. If you think rficonsole/rfigui is doing a bad job, I would suggest to experiment with the GUI to optimize the following settings:</p>
<ul>
<li>Horizontal resolution decrease factor before the sliding window fit action<br/>
LOFAR has a high time resolution (currently 1 sec by default). If your telescope / observation has a longer integration time or a very strong source far from the phase centre, this should be set to 1 instead of 3).</li>
<li>Kernel width (=kernel time size) of the sliding window fitting action<br/>
Once again, this depends on integration time and source field.</li>
<li>Kernel height (=kernel frequency size) of the sliding window fitting action<br/>
This depends on the channel resolution and frequency behaviour. Should be fine in most cases, but if your band pass is very steep (such as with WSRT), you might need to make it smaller. Another (actually better) solution is to correct for the band pass before running rficonsole.</li>
<li>Change the sensitivity of the SumThreshold action.</li>
<li>Enlarge the number of iterations (slower, but more stable)</li>
</ul>
<p>I have never seen an observation in which optimizing the settings did not work in the end, so don't give up. Make sure the phase centre does not change during the observation (see the question on multiple fields). You can always mail me and hand over a small part of your observation to let me take a look at the problem.</p>
<h3>I suspect a presence of RFI in my final reduced data</h3>
<p>That is well possible, even after using rficonsole. RFI console will only flag RFI that is (1) detectable and (2) not both broadband and continuous. Especially broadband <em>in situ</em> RFI (RFI generated by hardware near the telescope) can not be removed by flagging and might cause calibration failures and/or sidelobes while imaging. Other techniques should be used in such cases.</p>
<h3>How does rficonsole handle multiple bands in the same observation?</h3>
<p>It will treat them as separate baselines, which will be fine. If there is some problem, the best way is to split them into separate measurement sets. LOFAR never stores multiple bands in one measurement set by default, but WSRT does.</p>
<h3>How does rficonsole handle multiple fields in the same observation?</h3>
<p>I have not tested this, but it will probably treat the entire observation as a whole, and look at the concatenated baselines (i.e., time sort the data and assume the data should look the same). Therefore, if you sweep between a strong calibrator source and another field, <em>rficonsole might flag your calibrator completely!</em> Therefore, always split the measurement set when the phase centre changes. LOFAR will never store multiple sources in one measurement set, so for LOFAR this is not an issue.</p>
<h3>RFI console uses too much memory!</h3>
<p>Here are some hints on memory usage of rficonsole:</p>
<ul>
<li>First of all, the memory reported by <tt>top</tt> and similar <em>is not the actual memory usage</em>. It includes a so called "memory map", which is not actually used memory, but is hard disk space that is addressable as if it was memory. In most cases, this is the largest chunk reported by <tt>top</tt>. Therefore, as long as you don't get memory crashes or a lot of swapping, you should not worry about this huge number reported by <tt>top</tt>.</li>
<li>The <tt>casacore</tt> library uses internally a caching mechanism that should speed up reading of the data. I am not sure how the data is cached, but I noticed that the cache will slowly grow until all physical available memory is occupied. This looks like a memory leak, but memory usage should stop growing as soon as swapping is about to occur.</li>
<li>The minimal required memory is currently depending on three things: (1) the <a href="reading-mode.html">reading mode</a> (direct or indirect) ; (2) the number of threads being used (defaults to 4) ; and (3) the size of a single baseline. The system will approximately use <code>&lt;THREAD COUNT&gt; x 4 x &lt;BASELINE SIZE&gt;</code> bytes of memory in direct mode and <code>&lt;THREAD COUNT&gt; x 2.5 x &lt;BASELINE SIZE&gt;</code> bytes in indirect mode. The size of a single baseline can be calculated like <code>8 (bytes/complex float) x 4 (polarizations) x 256 (channels) x 6000 (time steps)</code> (thus 50 MB per baseline in this case, 0.5 GB in total, a rather typical LOFAR example). Hence, if the system really runs out of memory / starts swapping, <em>decrease the number of threads</em> as explained in the command line help of rficonsole and make sure to use the <em><a href="reading-mode.html">indirect reader</a></em>.</li>
<li>The software has been carefully tested for memory leaks, and there should not be any serious ones in it. A typical desktop machine should be able to run the software without problems.</li>
<li>Don't run multiple rficonsole's on the same machine. Run them sequential, not in parallel.</li>
</ul>
<h3>RFI console does not seem to use CPU / does not progress</h3>
<p>This probably means that reading the data takes a lot of time and the computing threads are awaiting new data. Reasons for slow IO can be:</p>
<ul>
<li>You are trying to run multiple rficonsole's on the same machine. Run them sequential, not in parallel.</li>
<li>The machine is low on memory, causing the cache to be too small or swapping. See the question about memory usage to improve memory.</li>
<li>Too many users on the storage node (/hard disk users).</li>
</ul>
<p>Generally, the <a href="reading-mode.html">indirect reading mode</a> is much faster than the direct reading mode.</p>
<h3>Crashes with a 'FLAG is readonly' message</h3>
<p>The full message is:</p>
<p><code>terminate called after throwing an instance of 'casa::TableInvOper'<br/>what():  Invalid Table operation: FLAG is readonly (use the ROxxxColumn class)</br>Abort</code></p>
<p>This means you are trying to flag raw LOFAR data in which the LofarStMan storage manager is used for the flag column. This storage manager is read only, and rficonsole can not update these flags. The <a href="http://www.mpa-garching.mpg.de/~fdg/LOFAR_cookbook/">LOFAR imaging cookbook</a> will tell you on changes, but the current way to solve this on the LOFAR cluster is:</p>
<p><code>makeFLAGwritable &lt;MyObservation.MS&gt;</code></p>
<p>This will take a few seconds to rewrite the flag column, after which you can run rficonsole.</p>
<h3>Plotting does not work in the GUI</h3>
<p>Plotting requires several programs:</p>
<ul>
<li><a href="http://www.gnuplot.info/">Gnuplot</a>, version 4.2 or higher</li>
<li>ps2pdf, which is part of the <a href="http://ghostscript.com/">Ghostscript</a> software</li>
<li>A pdf viewer. RFI gui will try to execute the command "./kpdf". Therefore, you will need a symlink in your working directory to this pdf viewer, and the symlink should be called "kpdf". </li>
</ul>
<p>If plotting is not working, check the terminal; RFI gui will output errors there.</p>
<h3>How do I use this new, faster reading mode?</h3>
<p>The mode is called the indirect reading mode, and is described on the following page: <a href="reading-mode.html">reading mode</a>.
<h3>What is the newest version of the RFI tools?</h3>
<p>The latest version is the one installed on the LOFAR cluster. This version is build daily from the Astron Subversion repository and should be the preferred version at all times, if you have access to it. If not, you can use the packaged version from <a href="http://www.astro.rug.nl/rfi-software">http://www.astro.rug.nl/rfi-software</a>. If the version there is older than two months, mail me so that I package the latest version -- it is in heavy development and many bugs and fixes are made within a month.</p>
<h3>Does rficonsole store e.g. the statistics in a log?</h3>
<p>Since October 2010, RFI console uses the LOFAR logger, which in turn uses LogCplus. Standard logging configuration can be set up in a configuration file. The parameters <code>-nolog</code> and <code>-v</code> can be used to alter logging strategy. The standard unix program <code>tee</code> can be used to save the output to file while at the same time monitoring the standard output.</p>
<h3>How does RFI console recognise RFI?</h3>
<p>It estimates the astronomical signal and searches for statistical abnormalities that look like lines in the time/frequency plots. It has several tricks to enhance the speed. The following papers describe parts of the detection technique in detail:</p>
<ul>
  <li><a href="http://adsabs.harvard.edu/doi/10.1111/j.1365-2966.2010.16471.x">Post-correlation radio frequency interference classification methods</a>, <em>MNRAS</em>, Volume 405, Issue 1, June 2010, pp. 155-167</li>
  <li><a href="http://adsabs.harvard.edu/abs/2010arXiv1007.2089O">A LOFAR RFI detection pipeline  and its first results</a></li>
</ul>
<h3>I still have questions / contact info</h3>
<p>I love to have feedback in order to update this FAQ and get a grib on common problems. You can reach me on my e-mail address, <code>&lt;my-last-name&gt;@astro.rug.nl</code>, and my last name is offringa.</p>
</body>
</html>

