<html>
<head><title>Offringa's RFI software</title></head>
<body>
<a href="http://www.astro.rug.nl/~offringa/">Offringa</a>-&gt;RFI software
<h3>RFI software</h3>
<p>This page describes the software to detect and mitigate radio frequency interference (RFI) in a radio measurement set. It is described in the article "Post-correlation radio frequency interference classification methods" by Offringa et al, published in <a href="http://adsabs.harvard.edu/doi/10.1111/j.1365-2966.2010.16471.x">MNRAS, Volume 405, Issue 1, pp. 155-167</a>. Please acknowledge this paper in publications in which the software is used. </p>
<p>I've made a "<a href="faq.html">Frequently Asked Questions</a>" page for the software and a short <a href="gui-tutorial.html">RFI GUI tutorial</a>.</p>
<p>Latest news: a new version was released - version 1.2.0, 28 Februari 2010.</p>
<p>Contents:</p>
<ul>
<li>Introduction</li>
<li>Download</li>
<li>Installation</li>
<li>Usage instructions</li>
<li>Problems and solutions</li>
<li>Contact information</li>
<li>Acknowledgment</li>
</ul>
<h3>Introduction</h3>
<p>The RFI software presented here can automatically flag data and can be used to analyze the data in a measurement. The purpose of flagging is to mark samples that are affected by interfering sources such as radio stations, airplanes, electrical fences or other transmitting interferers.</p>
<p>The tools in the package are meant for offline use. The software package contains a graphical interface ("<tt>rfigui</tt>") that can be used to visualize a measurement set and analyze mitigation techniques. It also contains a console flagger ("<tt>rficonsole</tt>") that can execute a script of mitigation functions without the overhead of a graphical environment. All tools were written in C++.</p>
<p>The software has been tested extensively on low radio frequencies (150 MHz or lower) produced by the <a href="http://www.astron.nl/radio-observatory/astronomers/wsrt-astronomers">WSRT</a> and <a href="http://www.lofar.org">LOFAR</a> telescopes. LOFAR is the Low Frequency Array that is built in and around the Netherlands. Higher frequencies should work as well. Some of the methods implemented are the <tt>SumThreshold</tt>, the <tt>VarThreshold</tt> and the singular value decomposition (SVD) method. Included also are several surface fitting algorithms.</p>
<p>The software is published under the GNU General Public License version 3.</p>
<h3>Download</h3>
<p>The latest version of the software is version 1.2.0 and can be downloaded here:</p>
<ul><li>Download: <a href="AOFlagger-1.3.0.tar.bz2">AOFlagger-1.3.0.tar.bz2</a> (26 April 2011, <a href="CHANGELOG">changelog</a>)</li></ul>
<ul><li>Download: <a href="AOFlagger-1.2.0.tar.bz2">AOFlagger-1.2.0.tar.bz2</a> (28 Februari 2011)</li></ul>
<ul><li>Download: <a href="AOFlagger-1.1.0.tar.bz2">AOFlagger-1.1.0.tar.bz2</a> (22 October 2010)</li></ul>
<p>You can not compile it right away; see the compilation instruction below.</p>
<h3>Installation</h3>
<p>The package contains part of the LOFAR software tree. In contrast to the previous version, this version does no longer including external libraries: they need to be installed separately. Most astronomical workstations will have most of the libraries.</p>
<h4>Requirements</h4>
<p>Below is a list of libraries that are required.</p>
<ul>
<li><a href="http://casacore.googlecode.com/">Casacore</a>, for opening measurement sets.</li>
<li><a href="http://www.fftw.org/">FFTW</a>, used to perform Fourier transformations.</a></li>
<li><a href="http://www.boost.org/">Boost</a>, used for threading, date and time calculations and some other general functionalities.</li>
<li><a href="http://xmlsoft.org/">libxml</a>, used for saving scripts / configurations.</li>
<li><a href="http://www.netlib.org/clapack/">CLAPACK</a>, for linear algebra, such as singular value decomposition.</li>
<li><a href="http://heasarc.nasa.gov/fitsio/">CFITSIO</a>, for reading and writing FITS files.</li>
<li><a href="http://www.gnu.org/software/gsl/">GNU Science Library</a>, for some generic mathematical operations (no longer required since version 1.2).</li>
<li>gtkmm (only for <tt>rfigui</tt>)</li>
</ul>
<p>All the libraries are available as free and open software. The gtkmm libraries and headers are only required to compile the gui. If they are not present, cmake will warn about it, but will compile the console programs nevertheless.</p>
<p>I would not encourage you to compile gtkmm yourself; it has many dependencies. Rather use your package manager (or ask your system administrator). Debian ships this library as "gtkmm-dev".</p>
<p>Some other libraries have to be available on the system (but are generally available). The complete list: </p>
<ul>
<li>png library</li>
<li>pthread library</li>
<li>dl, dynamic linking library</li>
<li>f2c, fortran-to-c library</li>
<li>cmake</li>
</ul>
<h4>Instructions for compilation</h4>
<p>The following steps explain the standard compilation procedure. It is probably recommendable that you start on a system where you have full administration rights, so you can easily find out what exact requirements are required.</p>
<ol>
<li>If you have not done so, install the required libraries. Most of the requirements can be fetched from Debian(like) repositories, with the exception of <a href="http://casacore.googlecode.com/">Casacore</a>.</li>
<li>Download and extract the software.</li>
<li>Enter the directory <tt>./LOFAR</tt> and create and enter a sub-directory called "build/gnu_opt": <tt>mkdir -p build/gnu_opt</tt>; <tt>cd build/gnu_opt</tt>
<li>Configure the package with cmake. If you installed all the libraries in their default location, you can issue the following command: <tt>cmake ../..</tt><br/>
CMake will tell you when some of the files can not be found. If you need to specify the location of libraries, e.g. for casacore and log4cpp, you can issue something like:
<tt>cmake ../.. -DCASACORE_ROOT_DIR=/home/offringa/casacore-install -DLOG4CPLUS_LIBRARY=/home/offringa/lib/liblog4cplus.a -DLOG4CPLUS_INCLUDE_DIR=/home/offringa/include/</tt></li>
<li>If CMake succeeds, you can start the compilation: <tt>make</tt></li>
</ol></ol>
<p>After the last step, the executables will be in the ./LOFAR/build/gnu_opt/CEP/DP3/AOFlagger/src directory, ready for action!</p>
<h4>Compilation issues</h4>
<ul>
<li>In case of errors about global-init.h, disable the logger: add <tt>-DUSE_LOG4CPLUS=OFF -DUSE_LOG4CXX=OFF</tt> to your CMake command.</li>
<li>Mac's will complain about errors related to malloc. Add <tt>-DUSE_SHMEM=OFF</tt> to your CMake command to fix this.</li>
</ul>
<h3>Usage instructions</h3>
<h4>rficonsole</h4>
<p>The <tt>rficonsole</tt> program is the simplest way of executing a strategy. To flag RFI in a measurement set, type the following command:</p>
<pre>./rficonsole &lt;path&#8209;to&#8209;ms&gt; [&lt;another&#8209;path&#8209;to&#8209;ms&gt; ...]</pre>
<p>This will run the default flagging strategy, which has the best balance between flagging quality and speed. The specified filename should normally be a .MS directory containing an AIPS measurement set. You can type <tt>./rficonsole</tt> without parameters to get information about its command. Currently, the following page is returned:</p>
<pre>./rficonsole
RFI strategy console runner
This program will execute an RFI strategy as can be created with the RFI gui
or a console program called rfistrategy, and executes it on one or several .MS
directories.

Author: Andr&eacute; Offringa (e-mail)

Usage: ./rficonsole [-j &lt;threadcount&gt;] [-strategy &lt;file.rfis&gt;] &lt;ms1&gt; [&lt;ms2&gt; [..]]</pre>
<h4>rfistrategy</h4>
<p>To customize the flagging process, you can run the rficonsole with an alternate strategy with the <tt>-strategy</tt> flag. You can create an <tt>.rfis</tt>-strategy file with the gui or with the rfistrategy command. rfistrategy is a console program. Run the rfistrategy command without parameters to get help:</p>
<pre>./rfistrategy
RFI strategy file writer
This program will write an RFI strategy to a file, to run it with the
rficonsole or the rfigui.

Author: Andr&eacute; Offringa (e-mail)

Usage: ./rfistrategy &lt;profile&gt; &lt;filename&gt;

Profiles:
        fast    Fastest strategy that provides a moderate
                result in quality. Will flag the measurement set using
                Stokes-I values, and by using a relatively small
                sliding window.
        average Best trade-off between speed and quality. Will
                flag the measurement set using stokes I values using
                an average sliding window size.
        best    Highest quality detection. Will flag each
                polarization individually, using a relatively large
                sliding window.
&lt;filename&gt; is the filename to which the strategy is written. This
file should have the extension ".rfis".

All profiles implement the SumThreshold method. The details of this
method are described in the article named "Post-correlation radio
frequency interference classification methods", submitted to MNRAS.</pre>
<p>The .rfis files are XML files and can be changed by hand or with a script in e.g. a full (offline) processing pipeline.</p>
<h4>rfigui</h4>
<p>The rfigui is a complex analyzation and experimentation tool which I use to create and test alternate flagging strategies, quickly visualize data sets and their flags, make graphs and perform all kind of mutations on the data set. Most features are self-explanatory and can be found in the main menu. Some features are still under heavy development and might not work (correctly). Some of its features are:</p>
<ul>
<li>Opening AIPS++ measurement sets and UV-FITS files.</li>
<li>Draw time-frequency graphs of Stokes I, single polarizations, phase or complex components of single baselines.</li>
<li>Execute, visualize and compare flagging strategies with or without changing a data set.</li>
<li>Create alternate flagging strategies by combining blocks of operations in a script tree. It works quite intuitively, e.g., by clicking on a block, one can change its parameters.</li>
<li>Create several plots; amplitude vs. time, frequency spectra, complex plane, time vs. flag count, frequency vs. flag count, antenna vs. flag count, etc.</li>
</ul>
<h3>Problems and solutions</h3>
<ul>
<li>If you have problems running the executables, and you get an error about loading libraries, a solution might be to explicitly define where the libraries are, i.e., type in:
<pre>export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:&lt;path&#8209;to&#8209;source&#8209;root&gt;/libs/lib/</pre></li>
<li>The gui uses gnuplot, ps2pdf and kpdf to create and visualize some of the graphs it creates. If plotting graphs does not work, make sure you have a symlink in the starting directory of rfigui named "kpdf" that links to whatever you like to use to visualize the generated pdf-files. GNU plot version 4.2 or higher is required.</li>
<li>If you have any further problems, don't hesitate to contact me! I will be glad to help out. See the section "contact information".</li>
</ul>
<h3>Contact information</h3>
<p>In case of questions, suggestions or feedback, please mail me. My e-mail address is <tt>&lt;mylastname&gt;@astro.rug.nl</tt>, and my last name is offringa.</p>
<h3>Acknowledgement</h3>
<p>Thanks to all who provided data to me for testing, in special Ger de Bruyn
and Gianni Bernardi. Also thanks to Andy Biggs who was the first unfortunate
one to try it on a Mac and face all incompatibities for the first time.
Thanks to Ger van Diepen for several fixes and hints.
The RFI tools heavily use Casacore, thus their authors have been instrumental
in creating the flagger.</p>
</body>
</html>

