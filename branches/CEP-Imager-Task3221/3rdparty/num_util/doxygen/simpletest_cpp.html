<pre><font face="Lucida,Courier New" color="#C00000"><font color="#808080">// Copyright 2006  Phil Austin (http://www.eos.ubc.ca/personal/paustin)</font>
<font color="#808080">// Distributed under the Boost Software License, Version 1.0. (See</font>
<font color="#808080">// accompanying file LICENSE_1_0.txt or copy at</font>
<font color="#808080">// http://www.boost.org/LICENSE_1_0.txt)</font>
<font color="#804000">
#define PY_ARRAY_UNIQUE_SYMBOL PyArrayHandle</font>
<font color="#804000">#include "num_util.h"</font>
<font color="#804000">#include &lt;iostream&gt;</font>

<font color="#0080ff"><b>namespace</b></font> <font color="#0000C0">{</font> <font color="#4040ff"><b>const</b></font> <font color="#4040ff"><b>char</b></font><font color="#0000C0">*</font> <font color="#000000">rcsid</font> <font color="#0000C0">=</font> <font color="#004080">"$Id: simpletest_cpp.html 38 2007-02-01 01:46:52Z phil $"</font><font color="#0000C0">;</font> <font color="#0000C0">}</font>

<font color="#0080ff"><b>namespace</b></font> <font color="#000000">bp</font><font color="#0000C0">=</font><font color="#000000">boost</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">python</font><font color="#0000C0">;</font>
<font color="#0080ff"><b>namespace</b></font> <font color="#000000">ar</font><font color="#0000C0">=</font><font color="#000000">boost</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">python</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">numeric</font><font color="#0000C0">;</font>
<font color="#0080ff"><b>namespace</b></font> <font color="#000000">nbpl</font> <font color="#0000C0">=</font> <font color="#000000">num_util</font><font color="#0000C0">;</font>

<font color="#808080">//send a dictionary with two arrays back to python</font>
<font color="#000000">bp</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">dict</font> <font color="#000000">testToPython</font><font color="#0000C0">(</font><font color="#4040ff"><b>void</b></font><font color="#0000C0">)</font><font color="#0000C0">{</font>
  <font color="#4040ff"><b>double</b></font> <font color="#000000">ia</font><font color="#0000C0">[</font><font color="#008080"><b>6</b></font><font color="#0000C0">]</font> <font color="#0000C0">=</font> <font color="#0000C0">{</font><font color="#008080"><b>1</b></font><font color="#0000C0">,</font><font color="#008080"><b>2</b></font><font color="#0000C0">,</font><font color="#008080"><b>3</b></font><font color="#0000C0">,</font><font color="#008080"><b>4</b></font><font color="#0000C0">,</font><font color="#008080"><b>5</b></font><font color="#0000C0">,</font><font color="#008080"><b>6</b></font><font color="#0000C0">}</font><font color="#0000C0">;</font>
  <font color="#4040ff"><b>int</b></font> <font color="#000000">ib</font><font color="#0000C0">[</font><font color="#008080"><b>3</b></font><font color="#0000C0">]</font> <font color="#0000C0">=</font> <font color="#0000C0">{</font><font color="#008080"><b>8</b></font><font color="#008080"><b>8</b></font><font color="#0000C0">,</font><font color="#008080"><b>9</b></font><font color="#008080"><b>9</b></font><font color="#0000C0">,</font><font color="#008080"><b>1</b></font><font color="#008080"><b>0</b></font><font color="#008080"><b>0</b></font><font color="#0000C0">}</font><font color="#0000C0">;</font>
  <font color="#808080">//construct two numpy arrays</font>
  <font color="#000000">ar</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">array</font> <font color="#000000">pyDoubles</font><font color="#0000C0">=</font><font color="#000000">nbpl</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">makeNum</font><font color="#0000C0">(</font><font color="#000000">ia</font><font color="#0000C0">,</font><font color="#008080"><b>6</b></font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#000000">ar</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">array</font> <font color="#000000">pyInts</font><font color="#0000C0">=</font><font color="#000000">nbpl</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">makeNum</font><font color="#0000C0">(</font><font color="#000000">ib</font><font color="#0000C0">,</font><font color="#008080"><b>3</b></font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#808080">//pack them in a dictionary and return to python</font>
  <font color="#000000">bp</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">dict</font> <font color="#000000">retvals</font><font color="#0000C0">;</font>
  <font color="#000000">retvals</font><font color="#0000C0">[</font><font color="#004080">"myDoubles"</font><font color="#0000C0">]</font><font color="#0000C0">=</font><font color="#000000">pyDoubles</font><font color="#0000C0">;</font>
  <font color="#000000">retvals</font><font color="#0000C0">[</font><font color="#004080">"myInts"</font><font color="#0000C0">]</font><font color="#0000C0">=</font><font color="#000000">pyInts</font><font color="#0000C0">;</font>
  <font color="#4040ff"><b>return</b></font> <font color="#000000">retvals</font><font color="#0000C0">;</font>
<font color="#0000C0">}</font>

<font color="#808080">//get an array from python</font>
<font color="#4040ff"><b>void</b></font> <font color="#000000">testFromPython</font><font color="#0000C0">(</font><font color="#000000">ar</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">array</font> <font color="#000000">inValue</font><font color="#0000C0">)</font><font color="#0000C0">{</font>
  <font color="#000000">nbpl</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">check_type</font><font color="#0000C0">(</font><font color="#000000">inValue</font><font color="#0000C0">,</font> <font color="#000000">PyArray_DOUBLE</font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#000000">nbpl</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">check_rank</font><font color="#0000C0">(</font><font color="#000000">inValue</font><font color="#0000C0">,</font> <font color="#008080"><b>2</b></font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#4040ff"><b>double</b></font><font color="#0000C0">*</font> <font color="#000000">dataPtr</font> <font color="#0000C0">=</font> <font color="#0000C0">(</font><font color="#4040ff"><b>double</b></font><font color="#0000C0">*</font><font color="#0000C0">)</font> <font color="#000000">nbpl</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">data</font><font color="#0000C0">(</font><font color="#000000">inValue</font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#4040ff"><b>int</b></font> <font color="#000000">theSize</font><font color="#0000C0">=</font> <font color="#000000">nbpl</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">size</font><font color="#0000C0">(</font><font color="#000000">inValue</font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#0000ff">std</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#0000ff">cout</font> <font color="#0000C0">&lt;</font><font color="#0000C0">&lt;</font> <font color="#0000ff">std</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">endl</font> <font color="#0000C0">&lt;</font><font color="#0000C0">&lt;</font> <font color="#004080">"data values on c++ side: "</font> <font color="#0000C0">&lt;</font><font color="#0000C0">&lt;</font> <font color="#0000ff">std</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">endl</font><font color="#0000C0">;</font>
  <font color="#4040ff"><b>for</b></font><font color="#0000C0">(</font><font color="#4040ff"><b>int</b></font> <font color="#000000">i</font><font color="#0000C0">=</font><font color="#008080"><b>0</b></font><font color="#0000C0">;</font><font color="#000000">i</font> <font color="#0000C0">&lt;</font> <font color="#000000">theSize</font><font color="#0000C0">;</font><font color="#0000C0">+</font><font color="#0000C0">+</font><font color="#000000">i</font><font color="#0000C0">)</font><font color="#0000C0">{</font>
     <font color="#0000ff">std</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#0000ff">cout</font> <font color="#0000C0">&lt;</font><font color="#0000C0">&lt;</font> <font color="#0000C0">*</font><font color="#0000C0">(</font><font color="#000000">dataPtr</font> <font color="#0000C0">+</font> <font color="#000000">i</font><font color="#0000C0">)</font> <font color="#0000C0">&lt;</font><font color="#0000C0">&lt;</font> <font color="#0000ff">std</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">endl</font><font color="#0000C0">;</font>
  <font color="#0000C0">}</font>
<font color="#0000C0">}</font>  
  
<font color="#000000">BOOST_PYTHON_MODULE</font><font color="#0000C0">(</font><font color="#000000">simple_ext</font><font color="#0000C0">)</font>
<font color="#0000C0">{</font> 
  <font color="#000000">import_array</font><font color="#0000C0">(</font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#000000">ar</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">array</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">set_module_and_type</font><font color="#0000C0">(</font><font color="#004080">"numpy"</font><font color="#0000C0">,</font> <font color="#004080">"ArrayType"</font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#808080">//global doc string</font>
  <font color="#000000">bp</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">scope</font><font color="#0000C0">(</font><font color="#0000C0">)</font><font color="#0000C0">.</font><font color="#000000">attr</font><font color="#0000C0">(</font><font color="#004080">"RCSID"</font><font color="#0000C0">)</font> <font color="#0000C0">=</font> <font color="#000000">rcsid</font><font color="#0000C0">;</font>
  <font color="#0000ff">std</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#0000ff">string</font> <font color="#000000">str1</font><font color="#0000C0">;</font>
  <font color="#000000">str1</font><font color="#0000C0">=</font><font color="#004080">"docstring for module\n"</font><font color="#0000C0">;</font>
  <font color="#000000">bp</font><font color="#0000C0">:</font><font color="#0000C0">:</font><font color="#000000">scope</font><font color="#0000C0">(</font><font color="#0000C0">)</font><font color="#0000C0">.</font><font color="#000000">attr</font><font color="#0000C0">(</font><font color="#004080">"__doc__"</font><font color="#0000C0">)</font> <font color="#0000C0">=</font> <font color="#000000">str1</font><font color="#0000C0">.</font><font color="#000000">c_str</font><font color="#0000C0">(</font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#000000">str1</font> <font color="#0000C0">=</font> <font color="#004080">"Doc string for testToPython\n"</font><font color="#0000C0">;</font>
  <font color="#000000">def</font><font color="#0000C0">(</font><font color="#004080">"testToPython"</font><font color="#0000C0">,</font> <font color="#000000">testToPython</font><font color="#0000C0">,</font><font color="#000000">str1</font><font color="#0000C0">.</font><font color="#000000">c_str</font><font color="#0000C0">(</font><font color="#0000C0">)</font><font color="#0000C0">)</font><font color="#0000C0">;</font>
  <font color="#000000">str1</font> <font color="#0000C0">=</font> <font color="#004080">"Doc string for testFromPython\n"</font><font color="#0000C0">;</font>
  <font color="#000000">def</font><font color="#0000C0">(</font><font color="#004080">"testFromPython"</font><font color="#0000C0">,</font> <font color="#000000">testFromPython</font><font color="#0000C0">,</font><font color="#000000">str1</font><font color="#0000C0">.</font><font color="#000000">c_str</font><font color="#0000C0">(</font><font color="#0000C0">)</font><font color="#0000C0">)</font><font color="#0000C0">;</font>
<font color="#0000C0">}</font>
</font></pre>