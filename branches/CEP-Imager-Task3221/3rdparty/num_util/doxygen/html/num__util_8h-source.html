<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>num_util: num_util.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.4 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<h1>num_util.h</h1><a href="num__util_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef NUM_UTIL_H__</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define NUM_UTIL_H__</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="comment">// Copyright 2006  Phil Austin (http://www.eos.ubc.ca/personal/paustin)</span>
<a name="l00005"></a>00005 <span class="comment">// Distributed under the Boost Software License, Version 1.0. (See</span>
<a name="l00006"></a>00006 <span class="comment">// accompanying file LICENSE_1_0.txt or copy at</span>
<a name="l00007"></a>00007 <span class="comment">// http://www.boost.org/LICENSE_1_0.txt)</span>
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">// $Id: num__util_8h-source.html 38 2007-02-01 01:46:52Z phil $</span>
<a name="l00011"></a>00011 <span class="comment">//</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;boost/python.hpp&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;numpy/arrayobject.h&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &lt;numeric&gt;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;complex&gt;</span>
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="keyword">namespace </span>num_util{
<a name="l00026"></a>00026 
<a name="l00031"></a>00031   boost::python::numeric::array <a class="code" href="namespacenum__util.html#a32">makeNum</a>(boost::python::object x);
<a name="l00032"></a>00032 
<a name="l00040"></a>00040   boost::python::numeric::array <a class="code" href="namespacenum__util.html#a32">makeNum</a>(intp n, PyArray_TYPES t);
<a name="l00041"></a>00041 
<a name="l00049"></a>00049   boost::python::numeric::array <a class="code" href="namespacenum__util.html#a32">makeNum</a>(std::vector&lt;intp&gt; dimens, 
<a name="l00050"></a>00050                                         PyArray_TYPES t);
<a name="l00051"></a>00051                                       
<a name="l00059"></a><a class="code" href="namespacenum__util.html#a61">00059</a>   <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt; PyArray_TYPES <a class="code" href="namespacenum__util.html#a61">getEnum</a>(<span class="keywordtype">void</span>)
<a name="l00060"></a>00060   {
<a name="l00061"></a>00061     PyErr_SetString(PyExc_ValueError, <span class="stringliteral">"no mapping available for this type"</span>);
<a name="l00062"></a>00062     boost::python::throw_error_already_set();
<a name="l00063"></a>00063     <span class="keywordflow">return</span> PyArray_VOID;
<a name="l00064"></a>00064   }
<a name="l00065"></a>00065 
<a name="l00075"></a><a class="code" href="namespacenum__util.html#a62">00075</a>   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; boost::python::numeric::array <a class="code" href="namespacenum__util.html#a32">makeNum</a>(T* <a class="code" href="namespacenum__util.html#a48">data</a>, intp n = 0){
<a name="l00076"></a>00076     boost::python::object obj(boost::python::handle&lt;&gt;(PyArray_FromDims(1, &amp;n, getEnum&lt;T&gt;())));
<a name="l00077"></a>00077     <span class="keywordtype">void</span> *arr_data = PyArray_DATA((PyArrayObject*) obj.ptr());
<a name="l00078"></a>00078     memcpy(arr_data, data, PyArray_ITEMSIZE((PyArrayObject*) obj.ptr()) * n); <span class="comment">// copies the input data to </span>
<a name="l00079"></a>00079     <span class="keywordflow">return</span> boost::python::extract&lt;boost::python::numeric::array&gt;(obj);
<a name="l00080"></a>00080   }
<a name="l00081"></a>00081 
<a name="l00092"></a><a class="code" href="namespacenum__util.html#a63">00092</a>   <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt; boost::python::numeric::array <a class="code" href="namespacenum__util.html#a32">makeNum</a>(T * <a class="code" href="namespacenum__util.html#a48">data</a>, std::vector&lt;intp&gt; dims){
<a name="l00093"></a>00093     intp total = std::accumulate(dims.begin(),dims.end(),1,std::multiplies&lt;intp&gt;());
<a name="l00094"></a>00094     boost::python::object obj(boost::python::handle&lt;&gt;(PyArray_FromDims(dims.size(),&amp;dims[0], getEnum&lt;T&gt;())));
<a name="l00095"></a>00095     <span class="keywordtype">void</span> *arr_data = PyArray_DATA((PyArrayObject*) obj.ptr());
<a name="l00096"></a>00096     memcpy(arr_data, data, PyArray_ITEMSIZE((PyArrayObject*) obj.ptr()) * total);
<a name="l00097"></a>00097     <span class="keywordflow">return</span> boost::python::extract&lt;boost::python::numeric::array&gt;(obj);
<a name="l00098"></a>00098   }
<a name="l00099"></a>00099     
<a name="l00100"></a>00100 
<a name="l00106"></a>00106   boost::python::numeric::array <a class="code" href="namespacenum__util.html#a32">makeNum</a>(<span class="keyword">const</span> 
<a name="l00107"></a>00107                                         boost::python::numeric::array&amp; arr);
<a name="l00108"></a>00108 
<a name="l00114"></a>00114   PyArray_TYPES <a class="code" href="namespacenum__util.html#a36">type</a>(boost::python::numeric::array arr);
<a name="l00115"></a>00115 
<a name="l00123"></a>00123   <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a37">check_type</a>(boost::python::numeric::array arr, 
<a name="l00124"></a>00124                   PyArray_TYPES expected_type);
<a name="l00125"></a>00125 
<a name="l00131"></a>00131   <span class="keywordtype">int</span> <a class="code" href="namespacenum__util.html#a38">rank</a>(boost::python::numeric::array arr);
<a name="l00132"></a>00132 
<a name="l00139"></a>00139   <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a39">check_rank</a>(boost::python::numeric::array arr, <span class="keywordtype">int</span> expected_rank);
<a name="l00140"></a>00140   
<a name="l00146"></a>00146   intp <a class="code" href="namespacenum__util.html#a40">size</a>(boost::python::numeric::array arr);
<a name="l00147"></a>00147   
<a name="l00155"></a>00155   <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a41">check_size</a>(boost::python::numeric::array arr, intp expected_size);
<a name="l00156"></a>00156 
<a name="l00162"></a>00162   std::vector&lt;intp&gt; <a class="code" href="namespacenum__util.html#a42">shape</a>(boost::python::numeric::array arr);
<a name="l00163"></a>00163 
<a name="l00170"></a>00170   intp <a class="code" href="namespacenum__util.html#a43">get_dim</a>(boost::python::numeric::array arr, <span class="keywordtype">int</span> dimnum);
<a name="l00171"></a>00171 
<a name="l00179"></a>00179   <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a44">check_shape</a>(boost::python::numeric::array arr, 
<a name="l00180"></a>00180                    std::vector&lt;intp&gt; expected_dims);
<a name="l00181"></a>00181 
<a name="l00190"></a>00190   <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a45">check_dim</a>(boost::python::numeric::array arr, <span class="keywordtype">int</span> dimnum, intp dimsize);
<a name="l00191"></a>00191 
<a name="l00197"></a>00197   <span class="keywordtype">bool</span> <a class="code" href="namespacenum__util.html#a46">iscontiguous</a>(boost::python::numeric::array arr);
<a name="l00198"></a>00198 
<a name="l00204"></a>00204   <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a47">check_contiguous</a>(boost::python::numeric::array arr);
<a name="l00205"></a>00205 
<a name="l00211"></a>00211   <span class="keywordtype">void</span>* <a class="code" href="namespacenum__util.html#a48">data</a>(boost::python::numeric::array arr);
<a name="l00212"></a>00212 
<a name="l00219"></a>00219   <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a49">copy_data</a>(boost::python::numeric::array arr, <span class="keywordtype">char</span>* new_data);
<a name="l00220"></a>00220   
<a name="l00226"></a>00226   boost::python::numeric::array <a class="code" href="namespacenum__util.html#a50">clone</a>(boost::python::numeric::array arr);
<a name="l00227"></a>00227   
<a name="l00234"></a>00234   boost::python::numeric::array <a class="code" href="namespacenum__util.html#a51">astype</a>(boost::python::numeric::array arr, 
<a name="l00235"></a>00235                                        PyArray_TYPES t);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="comment">/*    *Returns the reference count of the array. */</span>
<a name="l00239"></a>00239 <span class="comment">/*    *@param arr a Boost/Python numeric array. */</span>
<a name="l00240"></a>00240 <span class="comment">/*    *@return the reference count of the array. */</span>
<a name="l00241"></a>00241 
<a name="l00242"></a>00242   <span class="keywordtype">int</span> <a class="code" href="namespacenum__util.html#a53">refcount</a>(boost::python::numeric::array arr);
<a name="l00243"></a>00243 
<a name="l00249"></a>00249   std::vector&lt;intp&gt; <a class="code" href="namespacenum__util.html#a52">strides</a>(boost::python::numeric::array arr);
<a name="l00250"></a>00250 
<a name="l00257"></a>00257   <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a54">check_PyArrayElementType</a>(boost::python::object newo);
<a name="l00258"></a>00258 
<a name="l00262"></a><a class="code" href="namespacenum__util.html#a9">00262</a>   <span class="keyword">typedef</span> std::map&lt;PyArray_TYPES, std::string&gt; <a class="code" href="namespacenum__util.html#a9">KindStringMap</a>;
<a name="l00263"></a>00263 
<a name="l00267"></a><a class="code" href="namespacenum__util.html#a10">00267</a>   <span class="keyword">typedef</span> std::map&lt;PyArray_TYPES, char&gt; <a class="code" href="namespacenum__util.html#a10">KindCharMap</a>;
<a name="l00268"></a>00268 
<a name="l00272"></a><a class="code" href="namespacenum__util.html#a11">00272</a>   <span class="keyword">typedef</span> std::map&lt;char, PyArray_TYPES&gt; <a class="code" href="namespacenum__util.html#a11">KindTypeMap</a>;
<a name="l00273"></a>00273 
<a name="l00279"></a>00279   std::string <a class="code" href="namespacenum__util.html#a55">type2string</a>(PyArray_TYPES t_type);
<a name="l00280"></a>00280 
<a name="l00286"></a>00286   <span class="keywordtype">char</span> <a class="code" href="namespacenum__util.html#a56">type2char</a>(PyArray_TYPES t_type);
<a name="l00287"></a>00287   
<a name="l00293"></a>00293   PyArray_TYPES <a class="code" href="namespacenum__util.html#a57">char2type</a>(<span class="keywordtype">char</span> e_type);
<a name="l00294"></a>00294 
<a name="l00301"></a>00301   <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;
<a name="l00302"></a>00302   <span class="keyword">inline</span> std::string <a class="code" href="namespacenum__util.html#a58">vector_str</a>(<span class="keyword">const</span> std::vector&lt;T&gt;&amp; vec);
<a name="l00303"></a>00303 
<a name="l00311"></a>00311   <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacenum__util.html#a59">check_size_match</a>(std::vector&lt;intp&gt; dims, intp n);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 } <span class="comment">//  namespace num_util</span>
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Wed Jul 5 15:26:11 2006 for num_util by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.4 </small></address>
</body>
</html>
