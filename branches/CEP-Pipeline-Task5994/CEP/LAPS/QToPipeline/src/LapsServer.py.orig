#!/usr/bin/python

import sys
import os
import laps.MsgBus

print " setup connection "

msgbus = laps.MsgBus.Bus()


# get the Parset and the filename
message, filename = msgbus.get()

while message:
  	print "received :"
	f = open(filename,"wr")
	f.write(message)
	f.close() 

	parsetvals={}
	index=0
	for line in message.split('\n'):
		nme,val = line.partition("=")[::2]
		parsetvals[nme.strip()]=val.strip()
		#print "got %s : %s nvpair" %(nme,val) 
		#print "got line %d : %s " %(index,line)
		#index=index+1
	pythonprogram = parsetvals["ObsSW.Observation.ObservationControl.PythonControl.pythonProgram"] 
	os.system("startPython.sh %s %s >> logfile.txt 2>&1" %(pythonprogram,filename))
  	msgbus.ack()
	message, subject = msgbus.get()


