Used installation commands
==========================

Keep the latest version of this file in the LOFAR repos under LOFAR/RTCP/Cobalt/GPUProc/doc


Environment
-----------

* We assume the following 'loaded modules' (e.g. through .bashrc):
  module load gcc    # default on DAS-4
  module load sge    # idem
  module load fftw3/gcc/64
  module load openmpi/gcc/64
  module load cuda55/toolkit
  module load cuda55/fft
  module load hwloc
* We assume PATH contains ~/root/bin
  and LD_LIBRARY_PATH contains ~/root/lib

* Always pass at least -DCMAKE_INSTALL_PREFIX=~/root to cmake, or --prefix=/home/jenkins/root to ./configure.
* Make sure everything is linked using the same library versions (esp. for libhdf5).


Relevant files and directories
------------------------------

~/root/				installation root
~/root/src/			source and build directories
~/root/share/aips++/data/	CASA measures table location
~/jenkins/			location of the jenkins continuous build and integration system


Data Access Library (DAL)
-------------------------

Dependency for: LOFAR/RTCP/Cobalt/OutputProc

  cd ~/root/src
  git clone https://github.com/nextgen-astrodata/DAL.git DAL
  mkdir build
  cd build
  cmake -DCMAKE_INSTALL_PREFIX=~/root ..
  make -j 8 install
  ctest    # optional


cfitsio
-------

Dependency for: casacore, wcslib

  cd ~/root/src
  wget ftp://heasarc.gsfc.nasa.gov/software/fitsio/c/cfitsio_latest.tar.gz
  tar zxf cfitsio_latest.tar.gz
  cd cfitsio
  ./configure --prefix=/home/jenkins/root --enable-reentrant --enable-sse2 --enable-ssse3
  make -j 8 shared
  make install


wcslib
------

Dependency for: casacore

  cd ~/root/src
  wget ftp://ftp.atnf.csiro.au/pub/software/wcslib/wcslib.tar.bz2
  tar jxf wcslib.tar.bz2
  cd wcslib-4.18    # or whatever version you have
  ./configure --prefix=/home/jenkins/root --with-cfitsiolib=/home/jenkins/root/lib --with-cfitsioinc=/home/jenkins/root/include
  make -j 8 install


CASA measures tables
--------------------

Dependency for: casacore (keep the measure tables up to date, automatically!)

  cd ~/root/share    # or wherever
  mkdir aips++
  cd aips++
  wget ftp://ftp.atnf.csiro.au/pub/software/measures_data/measures_data.tar.bz2 ftp://ftp.atnf.csiro.au/pub/software/measures_data/measures_data.tar.bz2.md5sum
  md5sum measures_data.tar.bz2    # verify that md5 hash is equal to hash in measures_data.tar.bz2.md5sum (if you automate it, note that the .md5sum file contains a CSIRO full path name)
  tar jxf measures_data.tar.bz2

  # Now, add it to cron or jenkins (and update using symlink repointing, harden against network failures, partial downloads, etc, if there is a chance that you or others use it at any time)


casacore
--------

Dependency for: LOFAR/RTCP/Cobalt

Since we keep the measure data up to date (and since this install is the testing env standard), 
we use -DDATA_DIR=..., such that others can use our install AND measures tables.

  cd ~/root/src
  svn co http://casacore.googlecode.com/svn/trunk/ casacore
  mkdir build
  cd build
  cmake -DCMAKE_INSTALL_PREFIX=~/root -DUSE_HDF5=ON -DUSE_FFTW3=ON -DUSE_THREADS=ON -DUSE_OPENMP=ON -DDATA_DIR=~/root/share/aips++/data ..
  make -j 8 install
  ctest    # optional

  findmeastable    # verify that casacore can find the measures tables


LOFAR (Cobalt only)
-------------------

  cd ~/root/src
  svn co --username USERNAME -N https://svn.astron.nl/LOFAR/trunk LOFAR
  cd LOFAR
  svn up RTCP CMake LCS
  svn up    # Guarantee the same version in case somebody commits while 'svn up'-ing multiple subdirs.
  cd .. 
  mkdir -p LOFAR-build/gnu_opt
  cd LOFAR-build/gnu_opt
  cmake -DCMAKE_INSTALL_PREFIX=~/root -DBUILD_PACKAGES=Cobalt ../../LOFAR    # assumes you have all deps installed and a LOFAR/CMake/variants/variants.<hostname> file is in place
  make -j 8 install
  ctest    # optional
  . ~/root/lofarinit.sh    # often needed, but we will do this through jenkins

