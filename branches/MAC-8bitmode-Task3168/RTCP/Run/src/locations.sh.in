function isproduction() {
  [ "lofarsys" == "$USER" ]
}

TIMESTAMP=`date +%Y-%m-%d_%H%M%S`

if isproduction
then
  ISPRODUCTION=1

  CNPROC=$HOME/production/lofar/bgp_cn/bin/CN_Processing
  IONPROC=$HOME/production/lofar/bgp_ion/bin/ION_Processing
  ETCDIR=/opt/lofar/etc

  LOGDIR=$HOME/log/L$TIMESTAMP
  LOGSYMLINK=$HOME/log/latest
  LOGPARAMS="-s ccu001:24500"
else
  ISPRODUCTION=0

  CNPROC=$HOME/projects/LOFAR/installed/bgpcn_opt/bin/CN_Processing
  IONPROC=$HOME/projects/LOFAR/installed/bgpion_opt/bin/ION_Processing
  ETCDIR=@CMAKE_INSTALL_PREFIX@/etc

  LOGDIR=$HOME/projects/LOFAR/L$TIMESTAMP
  LOGSYMLINK=$HOME/projects/LOFAR/log
  LOGPARAMS="-v"
fi

if [ -d $ETCDIR ]
then
  . $ETCDIR/BlueGeneControl.conf
fi 

function set_psetinfo() {
  # list both the partition directly (small partitions) and recursively (large partitions) to get all -32 subpartitions
  # bghierarchy needs a valid stdin for some reason and will read from it, so provide a fake one
  if [ "$PARTITION" == "R00R01" ]
  then
    SUBPARTITIONS="`(bghierarchy -s R00 R01;bghierarchy -s \`bghierarchy -s R00 R01\`) </dev/null`"
  else
    SUBPARTITIONS="`(bghierarchy -s $PARTITION;bghierarchy -s \`bghierarchy -s $PARTITION\`) </dev/null`"
  fi  

  # a comma-separated list of all psets in $PARTITION
  # xxx-32 means both xxx-J00 and xxx-J01
  PSETS=`for i in $SUBPARTITIONS; do echo $i; done|grep -- "-32$"|sort -u|sed 's/-32$/-J00/;p;s/-J00$/-J01/'|xargs -L 1 host -4|cut -d\  -f 4|tr '\n' ','`

  # the address of the first pset in the $PARTITION
  FIRSTPSET=`for i in $SUBPARTITIONS; do echo $i; done|grep -- "-32$"|sort -u|sed 's/-32$/-J00/;p;s/-J00$/-J01/'|xargs -L 1 host -4|cut -d\  -f 4|head -n 1`
}

