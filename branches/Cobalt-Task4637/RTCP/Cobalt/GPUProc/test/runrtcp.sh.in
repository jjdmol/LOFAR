#!/bin/bash -x

if [ "$#" == "0" ]
then
  echo Usage: '[NRPROCS=x]' $0 '[params]'
  exit
fi

EXECUTABLE="@CMAKE_CURRENT_BINARY_DIR@/../src/rtcp"

HAVE_MPI="@HAVE_MPI@"

echo EXECUTABLE: $EXECUTABLE
echo HAVE_MPI: $HAVE_MPI

if [ "$HAVE_MPI" == "TRUE" ] # TODO: what to match here? I've seen TRUE and OFF
then
  # OpenMPI
  if [ "$NRPROCS" == "" ]
  then
    # A sane default for 1-3 stations
    NRPROCS=4
  fi

  mpirun -H localhost -np $NRPROCS "$EXECUTABLE" "$@"
else
  # No MPI
  "$EXECUTABLE" "$@"
fi
